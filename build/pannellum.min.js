(()=>{"use strict";window.pannellum=function(e,t,a){function n(n,o){var i,r,s,l,h,c,u,d,f,m,p,g,v=this,y=!1,w=Date.now(),x=0,b=0,E=-1,M=0,P=0,R=new Array(10),T=!1,_=!1,L=!1,I={yaw:0,pitch:0,hfov:0},C=!1,A=!1,S=0,F=0,N={},D={},B=[],O=!1,U=!1,k=1e-6,H=!1,z=!1,G={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:a,maxPitch:a,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:a,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:function(e){return e<.5?2*e*e:(4-2*e)*e-1},draggable:!0,dragConfirm:!1,disableKeyboardCtrl:!1,crossOrigin:"anonymous",targetBlank:!1,touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15,strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console.",twoTouchActivate:"Use two fingers together to pan the panorama.",twoTouchXActivate:"Use two fingers together to pan the panorama horizontally.",twoTouchYActivate:"Use two fingers together to pan the panorama vertically.",ctrlZoomActivate:"Use %s + scroll to zoom the panorama."}};(n="string"==typeof n?t.getElementById(n):n).classList.add("pnlm-container"),n.tabIndex=0;var Y=t.createElement("div");Y.className="pnlm-ui",n.appendChild(Y);var W=t.createElement("div");W.className="pnlm-render-container",n.appendChild(W);var X=t.createElement("div");X.className="pnlm-dragfix",Y.appendChild(X);var q=t.createElement("span");q.className="pnlm-about-msg";var V=t.createElement("a");V.href="https://pannellum.org/",V.textContent="Pannellum",q.appendChild(V);var Z=t.createElement("span");q.appendChild(Z),Y.appendChild(q),X.addEventListener("contextmenu",(function e(t){var a=re(t);q.style.left=a.x+"px",q.style.top=a.y+"px",clearTimeout(e.t1),clearTimeout(e.t2),q.style.display="block",q.style.opacity=1,e.t1=setTimeout((function(){q.style.opacity=0}),2e3),e.t2=setTimeout((function(){q.style.display="none"}),2500),t.preventDefault()}));var j={},K=t.createElement("div");K.className="pnlm-sprite pnlm-hot-spot-debug-indicator",Y.appendChild(K),j.container=t.createElement("div"),j.container.className="pnlm-panorama-info",j.title=t.createElement("div"),j.title.className="pnlm-title-box",j.container.appendChild(j.title),j.author=t.createElement("div"),j.author.className="pnlm-author-box",j.container.appendChild(j.author),Y.appendChild(j.container),j.load={},j.load.box=t.createElement("div"),j.load.box.className="pnlm-load-box",j.load.boxp=t.createElement("p"),j.load.box.appendChild(j.load.boxp),j.load.lbox=t.createElement("div"),j.load.lbox.className="pnlm-lbox",j.load.lbox.innerHTML='<div class="pnlm-loading"></div>',j.load.box.appendChild(j.load.lbox),j.load.lbar=t.createElement("div"),j.load.lbar.className="pnlm-lbar",j.load.lbarFill=t.createElement("div"),j.load.lbarFill.className="pnlm-lbar-fill",j.load.lbar.appendChild(j.load.lbarFill),j.load.box.appendChild(j.load.lbar),j.load.msg=t.createElement("p"),j.load.msg.className="pnlm-lmsg",j.load.box.appendChild(j.load.msg),Y.appendChild(j.load.box),j.errorMsg=t.createElement("div"),j.errorMsg.className="pnlm-error-msg pnlm-info-box",Y.appendChild(j.errorMsg),j.interactionMsg=t.createElement("div"),j.interactionMsg.className="pnlm-interaction-msg pnlm-info-box",Y.appendChild(j.interactionMsg);var $={};$.container=t.createElement("div"),$.container.className="pnlm-controls-container",Y.appendChild($.container),$.load=t.createElement("button"),$.load.className="pnlm-load-button",$.load.addEventListener("click",(function(){Ue(),We()})),Y.appendChild($.load),$.zoom=t.createElement("div"),$.zoom.className="pnlm-zoom-controls pnlm-controls",$.zoomIn=t.createElement("div"),$.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",$.zoomIn.addEventListener("click",(function(){h&&(Ge(i.hfov-5),_e())})),$.zoom.appendChild($.zoomIn),$.zoomOut=t.createElement("div"),$.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",$.zoomOut.addEventListener("click",(function(){h&&(Ge(i.hfov+5),_e())})),$.zoom.appendChild($.zoomOut),$.container.appendChild($.zoom),$.fullscreen=t.createElement("div"),$.fullscreen.addEventListener("click",ke),$.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&$.container.appendChild($.fullscreen),$.orientation=t.createElement("div"),$.orientation.addEventListener("click",(function(e){A?qe():Ve()})),$.orientation.addEventListener("mousedown",(function(e){e.stopPropagation()})),$.orientation.addEventListener("touchstart",(function(e){e.stopPropagation()})),$.orientation.addEventListener("pointerdown",(function(e){e.stopPropagation()})),$.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var J=!1;e.DeviceOrientationEvent&&"https:"==location.protocol&&(navigator.userAgent.toLowerCase().indexOf("mobi")>=0||navigator.userAgent.indexOf("Mac")>=0&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0)&&($.container.appendChild($.orientation),J=!0);var Q=t.createElement("div");function ee(){var n=t.createElement("div");if(n.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1!=n.getElementsByTagName("i").length){var o,r;if(f=i.hfov,m=i.pitch,"cubemap"==i.type){for(c=[],o=0;o<6;o++)c.push(new Image),c[o].crossOrigin=i.crossOrigin;j.load.lbox.style.display="block",j.load.lbar.style.display="none"}else if("multires"==i.type){var s=JSON.parse(JSON.stringify(i.multiRes));i.basePath&&i.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(i.multiRes.basePath)?s.basePath=i.basePath+i.multiRes.basePath:i.multiRes.basePath?s.basePath=i.multiRes.basePath:i.basePath&&(s.basePath=i.basePath),c=s}else if(!0===i.dynamic)c=i.panorama;else{if(i.panorama===a)return void ne(i.strings.noPanoramaError);c=new Image}if("cubemap"==i.type){var l=6,h=function(){0==--l&&ae()},u=function(e){var a=t.createElement("a");a.href=e.target.src,a.textContent=a.href,ne(i.strings.fileAccessError.replace("%s",a.outerHTML))};for(o=0;o<c.length;o++)"null"==(r=i.cubeMap[o])?(console.log("Will use background instead of missing cubemap face "+o),h()):(i.basePath&&!te(r)&&(r=i.basePath+r),c[o].onload=h,c[o].onerror=u,c[o].src=je(r))}else if("multires"==i.type)ae();else if(r="",i.basePath&&(r=i.basePath),!0!==i.dynamic){if(i.panorama instanceof Image||i.panorama instanceof ImageData||e.ImageBitmap&&i.panorama instanceof ImageBitmap)return c=i.panorama,void ae();r=te(i.panorama)?i.panorama:r+i.panorama,c.onload=function(){e.URL.revokeObjectURL(this.src),ae()},(g=new XMLHttpRequest).onloadend=function(){if(200!=g.status){var n=t.createElement("a");return n.href=r,n.textContent=n.href,void ne(i.strings.fileAccessError.replace("%s",n.outerHTML))}var o,s,l,h=this.response;o=h,s=r,(l=new FileReader).addEventListener("loadend",(function(){var n=l.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var r=n.indexOf("ÿÂ");(r<0||r>65536)&&ne(i.strings.iOS8WebGLError)}var h=n.indexOf("<x:xmpmeta");if(h>-1&&!0!==i.ignoreGPanoXMP){var u=n.substring(h,n.indexOf("</x:xmpmeta>")+12),d=function(e){var t;return u.indexOf(e+'="')>=0?t=(t=u.substring(u.indexOf(e+'="')+e.length+2)).substring(0,t.indexOf('"')):u.indexOf(e+">")>=0&&(t=(t=u.substring(u.indexOf(e+">")+e.length+1)).substring(0,t.indexOf("<"))),t!==a?Number(t):null},f={fullWidth:d("GPano:FullPanoWidthPixels"),croppedWidth:d("GPano:CroppedAreaImageWidthPixels"),fullHeight:d("GPano:FullPanoHeightPixels"),croppedHeight:d("GPano:CroppedAreaImageHeightPixels"),topPixels:d("GPano:CroppedAreaTopPixels"),heading:d("GPano:PoseHeadingDegrees"),horizonPitch:d("GPano:PosePitchDegrees"),horizonRoll:d("GPano:PoseRollDegrees"),pitch:d("GPano:InitialViewPitchDegrees"),yaw:d("GPano:InitialViewHeadingDegrees"),hfov:d("GPano:InitialHorizontalFOVDegrees")};null!==f.fullWidth&&null!==f.croppedWidth&&null!==f.fullHeight&&null!==f.croppedHeight&&null!==f.topPixels&&(B.indexOf("haov")<0&&(i.haov=f.croppedWidth/f.fullWidth*360),B.indexOf("vaov")<0&&(i.vaov=f.croppedHeight/f.fullHeight*180),B.indexOf("vOffset")<0&&(i.vOffset=-180*((f.topPixels+f.croppedHeight/2)/f.fullHeight-.5)),null!==f.heading&&B.indexOf("northOffset")<0&&(i.northOffset=f.heading,!1!==i.compass&&(i.compass=!0)),null!==f.horizonPitch&&null!==f.horizonRoll&&(B.indexOf("horizonPitch")<0&&(i.horizonPitch=f.horizonPitch),B.indexOf("horizonRoll")<0&&(i.horizonRoll=f.horizonRoll)),null!=f.pitch&&B.indexOf("pitch")<0&&(i.pitch=f.pitch),null!=f.yaw&&B.indexOf("yaw")<0&&(i.yaw=f.yaw),null!=f.hfov&&B.indexOf("hfov")<0&&(i.hfov=f.hfov))}c.src=e.URL.createObjectURL(o),c.onerror=function(){function a(){return e.fetch?e.fetch(t.location.href).then((function(e){return e.headers.get("Content-Security-Policy")})):null}a().then((function(e){if(e){var t=e.split(";").find((function(e){var t=e.match(/img-src(.*)/);if(t)return!t[1].includes("blob")}));t&&(console.log("CSP blocks blobs; reverting to URL."),c.crossOrigin=i.crossOrigin,c.src=s)}}))}})),l.readAsBinaryString!==a?l.readAsBinaryString(o):l.readAsText(o),j.load.msg.innerHTML=""},g.onprogress=function(e){if(e.lengthComputable){var t,a,n,o=e.loaded/e.total*100;j.load.lbarFill.style.width=o+"%",e.total>1e6?(t="MB",a=(e.loaded/1e6).toFixed(2),n=(e.total/1e6).toFixed(2)):e.total>1e3?(t="kB",a=(e.loaded/1e3).toFixed(1),n=(e.total/1e3).toFixed(1)):(t="B",a=e.loaded,n=e.total),j.load.msg.innerHTML=a+" / "+n+" "+t}else j.load.lbox.style.display="block",j.load.lbar.style.display="none"};try{g.open("GET",r,!0)}catch(e){ne(i.strings.malformedURLError)}g.responseType="blob",g.setRequestHeader("Accept","image/*,*/*;q=0.9"),g.withCredentials="use-credentials"===i.crossOrigin,g.send()}i.draggable&&Y.classList.add("pnlm-grab"),Y.classList.remove("pnlm-grabbing"),O=!0===i.dynamicUpdate,i.dynamic&&O&&(c=i.panorama,ae())}else ne()}function te(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function ae(){r||(r=new libpannellum.renderer(W)),L||(L=!0,X.addEventListener("mousedown",se,!1),t.addEventListener("mousemove",ce,!1),t.addEventListener("mouseup",ue,!1),i.mouseZoom&&(Y.addEventListener("mousewheel",xe,!1),Y.addEventListener("DOMMouseScroll",xe,!1)),i.doubleClickZoom&&X.addEventListener("dblclick",le,!1),n.addEventListener("mozfullscreenchange",He,!1),n.addEventListener("webkitfullscreenchange",He,!1),n.addEventListener("msfullscreenchange",He,!1),n.addEventListener("fullscreenchange",He,!1),"function"==typeof ResizeObserver?(p=new ResizeObserver(Te)).observe(n):(e.addEventListener("resize",Te,!1),e.addEventListener("orientationchange",Te,!1)),i.disableKeyboardCtrl||(n.addEventListener("keydown",be,!1),n.addEventListener("keyup",Me,!1),n.addEventListener("blur",Ee,!1)),t.addEventListener("mouseleave",ue,!1),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?(X.addEventListener("pointerdown",ve,!1),X.addEventListener("pointermove",ye,!1),X.addEventListener("pointerup",we,!1),X.addEventListener("pointerleave",we,!1)):(X.addEventListener("touchstart",de,!1),X.addEventListener("touchmove",fe,!1),X.addEventListener("touchend",me,!1)),e.navigator.pointerEnabled&&(n.style.touchAction="none")),function(){try{var e={};i.horizonPitch!==a&&(e.horizonPitch=i.horizonPitch*Math.PI/180),i.horizonRoll!==a&&(e.horizonRoll=i.horizonRoll*Math.PI/180),i.backgroundColor!==a&&(e.backgroundColor=i.backgroundColor),r.init(c,i.type,i.haov*Math.PI/180,i.vaov*Math.PI/180,i.vOffset*Math.PI/180,Se,e)}catch(e){if(!0!==i.dynamic&&(c=a),"webgl error"==e.type||"no webgl"==e.type)ne();else{if("webgl size error"!=e.type)throw ne(i.strings.unknownError),e;ne(i.strings.textureSizeError.replace("%s",e.width).replace("%s",e.maxWidth))}}}(),Ge(i.hfov),setTimeout((function(){}),500)}function ne(e){e===a&&(e=i.strings.genericWebGLError),j.errorMsg.innerHTML="<p>"+e+"</p>",$.load.style.display="none",j.load.box.style.display="none",j.errorMsg.style.display="table",_=!0,h=a,W.style.display="none",Ke("error",e)}function oe(e){j.interactionMsg.style.opacity=1,j.interactionMsg.innerHTML="<p>"+e+"</p>",j.interactionMsg.style.display="table",Ke("messageshown"),clearTimeout(j.interactionMsg.timeout),j.interactionMsg.removeEventListener("transitionend",ie),j.interactionMsg.timeout=setTimeout((function(){j.interactionMsg.style.opacity=0,j.interactionMsg.addEventListener("transitionend",ie)}),2e3)}function ie(){j.interactionMsg.style.opacity=0,j.interactionMsg.style.display="none",Ke("messagecleared")}function re(e){var t=n.getBoundingClientRect(),a={};return a.x=(e.clientX||e.pageX)-t.left,a.y=(e.clientY||e.pageY)-t.top,a}function se(e){if(e.preventDefault(),n.focus(),h&&i.draggable&&!i.draggingHotSpot){var t=re(e);if(i.hotSpotDebug){var a=he(e);console.log("Pitch: "+a[0]+", Yaw: "+a[1]+", Center Pitch: "+i.pitch+", Center Yaw: "+i.yaw+", HFOV: "+i.hfov)}Ye(),qe(),i.roll=0,I.hfov=0,y=!0,w=Date.now(),x=t.x,b=t.y,M=i.yaw,P=i.pitch,Y.classList.add("pnlm-grabbing"),Y.classList.remove("pnlm-grab"),Ke("mousedown",e),_e()}}function le(e){if(i.minHfov===i.hfov)v.setHfov(f,1e3);else{var t=he(e);v.lookAt(t[0],t[1],i.minHfov,1e3)}}function he(e){var t=re(e),a=r.getCanvas(),n=a.clientWidth,o=a.clientHeight,s=t.x/n*2-1,l=(1-t.y/o*2)*o/n,h=1/Math.tan(i.hfov*Math.PI/360),c=Math.sin(i.pitch*Math.PI/180),u=Math.cos(i.pitch*Math.PI/180),d=h*u-l*c,f=Math.sqrt(s*s+d*d),m=180*Math.atan((l*u+h*c)/f)/Math.PI,p=180*Math.atan2(s/f,d/f)/Math.PI+i.yaw;return p<-180&&(p+=360),p>180&&(p-=360),[m,p]}function ce(e){if(l)Ne(l,e);else if(y&&h){w=Date.now();var t=r.getCanvas(),a=t.clientWidth,n=t.clientHeight,o=re(e),s=180*(Math.atan(x/a*2-1)-Math.atan(o.x/a*2-1))/Math.PI*i.hfov/90+M;I.yaw=(s-i.yaw)%360*.2,i.yaw=s;var c=2*Math.atan(Math.tan(i.hfov/360*Math.PI)*n/a)*180/Math.PI,u=180*(Math.atan(o.y/n*2-1)-Math.atan(b/n*2-1))/Math.PI*c/90+P;I.pitch=.2*(u-i.pitch),i.pitch=u}}function ue(e){l&&l.dragHandlerFunc&&l.dragHandlerFunc(e,l.dragHandlerArgs),l=null,y&&(y=!1,Date.now()-w>15&&(I.pitch=I.yaw=0),Y.classList.add("pnlm-grab"),Y.classList.remove("pnlm-grabbing"),w=Date.now(),Ke("mouseup",e))}function de(e){if(h&&i.draggable&&!l){Ye(),qe(),i.roll=0,I.hfov=0;var t=re(e.targetTouches[0]);if(x=t.x,b=t.y,2==e.targetTouches.length){var a=re(e.targetTouches[1]);x+=.5*(a.x-t.x),b+=.5*(a.y-t.y),E=Math.sqrt((t.x-a.x)*(t.x-a.x)+(t.y-a.y)*(t.y-a.y))}y=!0,w=Date.now(),M=i.yaw,P=i.pitch,Ke("touchstart",e),_e()}}function fe(e){if(i.draggable&&(i.dragConfirm||e.preventDefault(),h&&(w=Date.now()),y&&h)){var t=re(e.targetTouches[0]),a=t.x,n=t.y;if(2==e.targetTouches.length&&-1!=E){var o=re(e.targetTouches[1]);a+=.5*(o.x-t.x),n+=.5*(o.y-t.y);var r=Math.sqrt((t.x-o.x)*(t.x-o.x)+(t.y-o.y)*(t.y-o.y));Ge(i.hfov+.1*(E-r)),E=r}var s=i.hfov/360*i.touchPanSpeedCoeffFactor;if(T||"both"!=i.dragConfirm&&"yaw"!=i.dragConfirm||2==e.targetTouches.length){var l=(x-a)*s+M;I.yaw=(l-i.yaw)%360*.2,i.yaw=l}else x!=a&&("yaw"==i.dragConfirm?oe(i.strings.twoTouchXActivate):oe(i.strings.twoTouchActivate));if(T||"both"!=i.dragConfirm&&"pitch"!=i.dragConfirm||2==e.targetTouches.length){var c=(n-b)*s+P;I.pitch=.2*(c-i.pitch),i.pitch=c}else b!=n&&("pitch"==i.dragConfirm?oe(i.strings.twoTouchYActivate):oe(i.strings.twoTouchActivate));"yaw"!=i.dragConfirm&&"pitch"!=i.dragConfirm&&"both"!=i.dragConfirm||2!=e.targetTouches.length||(ie(),e.preventDefault())}}function me(){l=null,y=!1,Date.now()-w>150&&(I.pitch=I.yaw=0),E=-1,w=Date.now(),Ke("touchend",event)}Q.className="pnlm-compass pnlm-controls pnlm-control",Y.appendChild(Q),o.firstScene?Oe(o.firstScene):o.default&&o.default.firstScene?Oe(o.default.firstScene):Oe(null),Ue(!0);var pe=[],ge=[];function ve(e){if("touch"==e.pointerType){if(!h||!i.draggable)return;pe.push(e.pointerId),ge.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=ge,de(e),e.preventDefault()}}function ye(e){if("touch"==e.pointerType){if(l)return void Ne(l,e);if(!i.draggable)return;for(var t=0;t<pe.length;t++)if(e.pointerId==pe[t])return ge[t].clientX=e.clientX,ge[t].clientY=e.clientY,e.targetTouches=ge,fe(e),void e.preventDefault()}}function we(e){if(l&&l.dragHandlerFunc&&l.dragHandlerFunc(e,l.dragHandlerArgs),l=null,"touch"==e.pointerType){for(var t=!1,n=0;n<pe.length;n++)e.pointerId==pe[n]&&(pe[n]=a),pe[n]&&(t=!0);t||(pe=[],ge=[],me()),e.preventDefault()}}function xe(e){if(h&&("fullscreenonly"!=i.mouseZoom||T))if(T||"ctrl"!=i.mouseZoom||e.ctrlKey)ie(),e.preventDefault(),Ye(),w=Date.now(),e.wheelDeltaY?(Ge(i.hfov-.05*e.wheelDeltaY),I.hfov=e.wheelDelta<0?1:-1):e.wheelDelta?(Ge(i.hfov-.05*e.wheelDelta),I.hfov=e.wheelDelta<0?1:-1):e.detail&&(Ge(i.hfov+1.5*e.detail),I.hfov=e.detail>0?1:-1),_e();else{var t=-1!=navigator.platform.indexOf("Mac")?"control":"ctrl";oe(i.strings.ctrlZoomActivate.replace("%s",'<kbd class="pnlm-outline">'+t+"</kbd>"))}}function be(e){Ye(),w=Date.now(),qe(),i.roll=0;var t=e.which||e.keycode;i.capturedKeyNumbers.indexOf(t)<0||(T||16!=t&&17!=t||"ctrl"!=i.mouseZoom)&&(e.preventDefault(),27==t?T&&ke():Pe(t,!0))}function Ee(){for(var e=0;e<10;e++)R[e]=!1}function Me(e){var t=e.which||e.keycode;i.capturedKeyNumbers.indexOf(t)<0||(e.preventDefault(),Pe(t,!1))}function Pe(e,t){var a=!1;switch(e){case 109:case 189:case 17:case 173:R[0]!=t&&(a=!0),R[0]=t;break;case 107:case 187:case 16:case 61:R[1]!=t&&(a=!0),R[1]=t;break;case 38:R[2]!=t&&(a=!0),R[2]=t;break;case 87:R[6]!=t&&(a=!0),R[6]=t;break;case 40:R[3]!=t&&(a=!0),R[3]=t;break;case 83:R[7]!=t&&(a=!0),R[7]=t;break;case 37:R[4]!=t&&(a=!0),R[4]=t;break;case 65:R[8]!=t&&(a=!0),R[8]=t;break;case 39:R[5]!=t&&(a=!0),R[5]=t;break;case 68:R[9]!=t&&(a=!0),R[9]=t}a&&t&&(u="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),_e())}function Re(e){var t=N[e],a=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0)),n=t.startPosition+i.animationTimingFunction(a)*(t.endPosition-t.startPosition);(t.endPosition>t.startPosition&&n>=t.endPosition||t.endPosition<t.startPosition&&n<=t.endPosition||t.endPosition===t.startPosition)&&(n=t.endPosition,I[e]=0,delete N[e]),i[e]=n}function Te(){He("resize")}function _e(){C||(C=!0,Le())}function Le(){if(!z)if(function(){var e;if(h){var t=r.getCanvas();!1!==i.autoRotate&&(i.yaw>360?i.yaw-=360:i.yaw<-360&&(i.yaw+=360)),e=i.yaw;var n=0;if(i.avoidShowingBackground){var o=i.hfov/2,s=180*Math.atan2(Math.tan(o/180*Math.PI),t.width/t.height)/Math.PI;i.vaov>i.haov?Math.min(Math.cos((i.pitch-o)/180*Math.PI),Math.cos((i.pitch+o)/180*Math.PI)):n=o*(1-Math.min(Math.cos((i.pitch-s)/180*Math.PI),Math.cos((i.pitch+s)/180*Math.PI)))}var l=i.maxYaw-i.minYaw,c=-180,d=180;l<360&&(c=i.minYaw+i.hfov/2+n,d=i.maxYaw-i.hfov/2-n,l<i.hfov&&(c=d=(c+d)/2),i.yaw=Math.max(c,Math.min(d,i.yaw))),!1===i.autoRotate&&(i.yaw>360?i.yaw-=360:i.yaw<-360&&(i.yaw+=360)),!1!==i.autoRotate&&e!=i.yaw&&u!==a&&(i.autoRotate*=-1);var f=2*Math.atan(Math.tan(i.hfov/180*Math.PI*.5)/(t.width/t.height))/Math.PI*180,m=i.minPitch+f/2,p=i.maxPitch-f/2;i.maxPitch-i.minPitch<f&&(m=p=(m+p)/2),isNaN(m)&&(m=-90),isNaN(p)&&(p=90),i.pitch=Math.max(m,Math.min(p,i.pitch)),r.render(i.pitch*Math.PI/180,i.yaw*Math.PI/180,i.hfov*Math.PI/180,{roll:i.roll*Math.PI/180,dynamic:O}),U&&(U=O=!1),Be(),i.compass&&(Q.style.transform="rotate("+(-i.yaw-i.northOffset)+"deg)",Q.style.webkitTransform="rotate("+(-i.yaw-i.northOffset)+"deg)")}}(),d&&clearTimeout(d),y||!0===A)requestAnimationFrame(Le);else if(R[0]||R[1]||R[2]||R[3]||R[4]||R[5]||R[6]||R[7]||R[8]||R[9]||i.autoRotate||N.pitch||N.yaw||N.hfov||Math.abs(I.yaw)>.01||Math.abs(I.pitch)>.01||Math.abs(I.hfov)>.01)!function(){if(h){var e,t=!1,n=i.pitch,o=i.yaw,r=i.hfov;e="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),u===a&&(u=e);var s=(e-u)*i.hfov/1200;if(s=Math.min(s,10),R[0]&&!0===i.keyboardZoom&&(Ge(i.hfov+(.8*I.hfov+.4)*s),t=!0),R[1]&&!0===i.keyboardZoom&&(Ge(i.hfov+(.8*I.hfov-.2)*s),t=!0),(R[2]||R[6])&&(i.pitch+=(.8*I.pitch+.2)*s,t=!0),(R[3]||R[7])&&(i.pitch+=(.8*I.pitch-.2)*s,t=!0),(R[4]||R[8])&&(i.yaw+=(.8*I.yaw-.2)*s,t=!0),(R[5]||R[9])&&(i.yaw+=(.8*I.yaw+.2)*s,t=!0),t&&(w=Date.now()),i.autoRotate){if(e-u>.001){var l=(e-u)/1e3,c=(I.yaw/l*s-.2*i.autoRotate)*l;c=(-i.autoRotate>0?1:-1)*Math.min(Math.abs(i.autoRotate*l),Math.abs(c)),i.yaw+=c}i.autoRotateStopDelay&&(i.autoRotateStopDelay-=e-u,i.autoRotateStopDelay<=0&&(i.autoRotateStopDelay=!1,F=i.autoRotate,i.autoRotate=0))}if(N.pitch&&(Re("pitch"),n=i.pitch),N.yaw&&(Re("yaw"),o=i.yaw),N.hfov&&(Re("hfov"),r=i.hfov),s>0&&!i.autoRotate){var d=1-i.friction;R[4]||R[5]||R[8]||R[9]||N.yaw||(i.yaw+=I.yaw*s*d),R[2]||R[3]||R[6]||R[7]||N.pitch||(i.pitch+=I.pitch*s*d),R[0]||R[1]||N.hfov||(i.hfov>90&&(d*=1-(i.hfov-90)/90),Ge(i.hfov+I.hfov*s*d))}if(u=e,s>0){I.yaw=.8*I.yaw+(i.yaw-o)/s*.2,I.pitch=.8*I.pitch+(i.pitch-n)/s*.2,I.hfov=.8*I.hfov+(i.hfov-r)/s*.2;var f=i.autoRotate?Math.abs(i.autoRotate):5;I.yaw=Math.min(f,Math.max(I.yaw,-f)),I.pitch=Math.min(f,Math.max(I.pitch,-f)),I.hfov=Math.min(f,Math.max(I.hfov,-f))}R[0]&&R[1]&&(I.hfov=0),(R[2]||R[6])&&(R[3]||R[7])&&(I.pitch=0),(R[4]||R[8])&&(R[5]||R[9])&&(I.yaw=0)}}(),i.autoRotateInactivityDelay>=0&&F&&Date.now()-w>i.autoRotateInactivityDelay&&!i.autoRotate&&(i.autoRotate=F,v.lookAt(m,a,f,3e3)),requestAnimationFrame(Le);else if(r&&(r.isLoading()||!0===i.dynamic&&O))requestAnimationFrame(Le);else{v.getPitch&&v.getYaw&&v.getHfov&&Ke("animatefinished",{pitch:v.getPitch(),yaw:v.getYaw(),hfov:v.getHfov()}),C=!1,u=a;var e=i.autoRotateInactivityDelay-(Date.now()-w);e>0?d=setTimeout((function(){i.autoRotate=F,v.lookAt(m,a,f,3e3),_e()}),e):i.autoRotateInactivityDelay>=0&&F&&(i.autoRotate=F,v.lookAt(m,a,f,3e3),_e())}}function Ie(e,t,a,n){this.w=e,this.x=t,this.y=a,this.z=n}function Ce(t,a,n){var o=function(e,t,a){var n=[t?t*Math.PI/180/2:0,a?a*Math.PI/180/2:0,e?e*Math.PI/180/2:0],o=[Math.cos(n[0]),Math.cos(n[1]),Math.cos(n[2])],i=[Math.sin(n[0]),Math.sin(n[1]),Math.sin(n[2])];return new Ie(o[0]*o[1]*o[2]-i[0]*i[1]*i[2],i[0]*o[1]*o[2]-o[0]*i[1]*i[2],o[0]*i[1]*o[2]+i[0]*o[1]*i[2],o[0]*o[1]*i[2]+i[0]*i[1]*o[2])}(t,a,n);o=o.multiply(new Ie(Math.sqrt(.5),-Math.sqrt(.5),0,0));var i=e.orientation?-e.orientation*Math.PI/180/2:0;return o.multiply(new Ie(Math.cos(i),0,-Math.sin(i),0))}function Ae(e){var t=Ce(e.alpha,e.beta,e.gamma).toEulerAngles();"number"==typeof A&&A<10?A+=1:10===A?(S=t[2]/Math.PI*180+i.yaw,A=!0,requestAnimationFrame(Le)):(i.pitch=t[0]/Math.PI*180,i.roll=-t[1]/Math.PI*180,i.yaw=-t[2]/Math.PI*180+S)}function Se(){if(i.sceneFadeDuration&&r.fadeImg!==a){r.fadeImg.style.opacity=0;var e=r.fadeImg;delete r.fadeImg,setTimeout((function(){W.removeChild(e),Ke("scenechangefadedone")}),i.sceneFadeDuration)}i.compass?Q.style.display="inline":Q.style.display="none",H||(i.hotSpots?(i.hotSpots=i.hotSpots.sort((function(e,t){return e.pitch<t.pitch})),i.hotSpots.forEach(Fe)):i.hotSpots=[],H=!0,Be()),j.load.box.style.display="none",s!==a&&(W.removeChild(s),s=a),h=!0,!0!==i.dynamic&&(c=a),_e(),Ke("load")}function Fe(e){if(e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0,!e.id)throw new Error("Cannot read propert id at hotspot component");var a=t.createElement("div");a.tabIndex=-1,a.className="pnlm-hotspot-base",a.dataset.id=e.id,e.cssClass?a.className+=" "+e.cssClass:a.className+=" pnlm-hotspot pnlm-sprite pnlm-"+Ze(e.type);var n,o=t.createElement("span");if(e.text&&(o.innerHTML=Ze(e.text)),e.video){var r=t.createElement("video"),s=e.video;i.basePath&&!te(s)&&(s=i.basePath+s),r.src=je(s),r.controls=!0,r.style.width=e.width+"px",Y.appendChild(a),o.appendChild(r)}else if(e.image){var h=e.image;i.basePath&&!te(h)&&(h=i.basePath+h),(n=t.createElement("a")).href=je(e.URL?e.URL:h,!0),i.targetBlank&&(n.target="_blank",n.rel="noopener"),o.appendChild(n);var c=t.createElement("img");c.src=je(h),c.style.width=e.width+"px",c.style.paddingTop="5px",Y.appendChild(a),n.appendChild(c),o.style.maxWidth="initial"}else if(e.URL){if((n=t.createElement("a")).href=je(e.URL,!0),e.attributes)for(var u in e.attributes)n.setAttribute(u,e.attributes[u]);else i.targetBlank&&(n.target="_blank",n.rel="noopener");Y.appendChild(n),a.className+=" pnlm-pointer",o.className+=" pnlm-pointer",n.appendChild(a)}else e.sceneId&&(a.onclick=a.ontouchend=function(){return a.clicked||(a.clicked=!0,Xe(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},a.className+=" pnlm-pointer",o.className+=" pnlm-pointer"),Y.appendChild(a);e.createTooltipFunc?e.createTooltipFunc(a,e.createTooltipArgs):(e.text||e.video||e.image)&&(a.classList.add("pnlm-tooltip"),a.appendChild(o),o.style.width=o.scrollWidth-20+"px",o.style.marginLeft=-(o.scrollWidth-a.offsetWidth)/2+"px",o.style.marginTop=-o.scrollHeight-12+"px"),e.clickHandlerFunc&&(a.addEventListener("click",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),"false"),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?a.addEventListener("pointerup",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),!1):a.addEventListener("touchend",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),!1),a.className+=" pnlm-pointer",o.className+=" pnlm-pointer"),e.draggable&&(a.addEventListener("mousedown",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),l=e})),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction&&a.addEventListener("pointerdown",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),l=e})),a.addEventListener("touchmove",(function(t){Ne(e,t.targetTouches[0])})),a.addEventListener("touchend",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),l=null}))),e.div=a}function Ne(e,t){var a=he(t);e.pitch=a[0],e.yaw=a[1],De(e)}function De(e){var t=Math.sin(e.pitch*Math.PI/180),a=Math.cos(e.pitch*Math.PI/180),n=Math.sin(i.pitch*Math.PI/180),o=Math.cos(i.pitch*Math.PI/180),s=Math.cos((-e.yaw+i.yaw)*Math.PI/180),l=t*n+a*s*o;if(e.yaw<=90&&e.yaw>-90&&l<=0||(e.yaw>90||e.yaw<=-90)&&l<=0)e.div.style.visibility="hidden";else{var h=Math.sin((-e.yaw+i.yaw)*Math.PI/180),c=Math.tan(i.hfov*Math.PI/360);e.div.style.visibility="visible";var u=r.getCanvas(),d=u.clientWidth,m=u.clientHeight,p=[-d/c*h*a/l/2,-d/c*(t*o-a*s*n)/l/2],g=Math.sin(i.roll*Math.PI/180),v=Math.cos(i.roll*Math.PI/180);(p=[p[0]*v-p[1]*g,p[0]*g+p[1]*v])[0]+=(d-e.div.offsetWidth)/2,p[1]+=(m-e.div.offsetHeight)/2;var y="translate("+p[0]+"px, "+p[1]+"px) translateZ(9999px) rotate("+i.roll+"deg)";e.scale&&("number"==typeof e.scale?y+=" scale("+e.scale+")":y+=" scale("+f/i.hfov/l+")"),e.div.style.webkitTransform=y,e.div.style.MozTransform=y,e.div.style.transform=y}}function Be(){i.hotSpots.forEach(De)}function Oe(e){var t,a;i={};var n=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];for(t in B=[],G)G.hasOwnProperty(t)&&(i[t]=G[t]);for(t in o.default)if(o.default.hasOwnProperty(t))if("strings"==t)for(a in o.default.strings)o.default.strings.hasOwnProperty(a)&&(i.strings[a]=Ze(o.default.strings[a]));else i[t]=o.default[t],n.indexOf(t)>=0&&B.push(t);if(null!==e&&""!==e&&o.scenes&&o.scenes[e]){var r=o.scenes[e];for(t in r)if(r.hasOwnProperty(t))if("strings"==t)for(a in r.strings)r.strings.hasOwnProperty(a)&&(i.strings[a]=Ze(r.strings[a]));else i[t]=r[t],n.indexOf(t)>=0&&B.push(t);i.scene=e}for(t in o)if(o.hasOwnProperty(t))if("strings"==t)for(a in o.strings)o.strings.hasOwnProperty(a)&&(i.strings[a]=Ze(o.strings[a]));else i[t]=o[t],n.indexOf(t)>=0&&B.push(t)}function Ue(e){if((e=e||!1)&&"preview"in i){var n=i.preview;i.basePath&&!te(n)&&(n=i.basePath+n),(s=t.createElement("div")).className="pnlm-preview-img",s.style.backgroundImage="url('"+je(n).replace(/"/g,"%22").replace(/'/g,"%27")+"')",W.appendChild(s)}var o=i.title,l=i.author;for(var h in e&&("previewTitle"in i&&(i.title=i.previewTitle),"previewAuthor"in i&&(i.author=i.previewAuthor)),i.hasOwnProperty("title")||(j.title.innerHTML=""),i.hasOwnProperty("author")||(j.author.innerHTML=""),i.hasOwnProperty("title")||i.hasOwnProperty("author")||(j.container.style.display="none"),i.targetBlank&&(V.rel="noopener",V.target="_blank"),$.load.innerHTML="<div><p>"+i.strings.loadButtonLabel+"</p></div>",j.load.boxp.innerHTML=i.strings.loadingLabel,i)if(i.hasOwnProperty(h))switch(h){case"title":j.title.innerHTML=Ze(i[h]),j.container.style.display="inline";break;case"author":var c=Ze(i[h]);if(i.authorURL){var u=t.createElement("a");u.href=je(i.authorURL,!0),i.targetBlank&&(u.target="_blank",u.rel="noopener"),u.innerHTML=Ze(i[h]),c=u.outerHTML}j.author.innerHTML=i.strings.bylineLabel.replace("%s",c),j.container.style.display="inline";break;case"hfov":Ge(Number(i[h]));break;case"autoLoad":!0===i[h]&&r===a&&(j.load.box.style.display="inline",$.load.style.display="none",ee());break;case"showZoomCtrl":i[h]&&0!=i.showControls?$.zoom.style.display="block":$.zoom.style.display="none";break;case"showFullscreenCtrl":i[h]&&0!=i.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?$.fullscreen.style.display="block":$.fullscreen.style.display="none";break;case"hotSpotDebug":i[h]?K.style.display="block":K.style.display="none";break;case"showControls":i[h]||($.orientation.style.display="none",$.zoom.style.display="none",$.fullscreen.style.display="none");break;case"orientationOnByDefault":i[h]&&Ve()}e&&(o?i.title=o:delete i.title,l?i.author=l:delete i.author)}function ke(){if(h&&!_)if(T)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen?n.msRequestFullscreen():n.webkitRequestFullScreen()}catch(e){}}function He(e){t.fullscreenElement||t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?($.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),T=!0):($.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),T=!1),"resize"!==e&&Ke("fullscreenchange",T),r.resize(),Ge(i.hfov),_e()}function ze(e){var t=i.minHfov;if("multires"==i.type&&r&&!i.multiResMinHfov&&(t=Math.min(t,r.getCanvas().width/(i.multiRes.cubeResolution/90*.9))),t>i.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),i.hfov;var a=i.hfov;if(a=e<t?t:e>i.maxHfov?i.maxHfov:e,i.avoidShowingBackground&&r&&!isNaN(i.maxPitch-i.minPitch)){var n=r.getCanvas();a=Math.min(a,360*Math.atan(Math.tan((i.maxPitch-i.minPitch)/360*Math.PI)/n.height*n.width)/Math.PI)}return a}function Ge(e){i.hfov=ze(e),Ke("zoomchange",i.hfov)}function Ye(){N={},F=i.autoRotate?i.autoRotate:F,i.autoRotate=!1}function We(){_&&(j.load.box.style.display="none",j.errorMsg.style.display="none",_=!1,W.style.display="block",Ke("errorcleared")),h=!1,ie(),$.load.style.display="none",j.load.box.style.display="inline",ee()}function Xe(e,n,s,l,c){var u,d,f,m;if(h||(c=!0),h=!1,N={},i.sceneFadeDuration&&!c){var p=r.render(i.pitch*Math.PI/180,i.yaw*Math.PI/180,i.hfov*Math.PI/180,{returnImage:"ImageBitmap"});if(p!==a)return(u=p.then?t.createElement("canvas"):new Image).className="pnlm-fade-img",u.style.transition="opacity "+i.sceneFadeDuration/1e3+"s",u.style.width="100%",u.style.height="100%",p.then?p.then((function(t){u.width=t.width,u.height=t.height,u.getContext("2d").drawImage(t,0,0),Xe(e,n,s,l,!0)})):(u.onload=function(){Xe(e,n,s,l,!0)},u.src=p),W.appendChild(u),void(r.fadeImg=u)}d="same"===n?i.pitch:n,f="same"===s?i.yaw:"sameAzimuth"===s?i.yaw+(i.northOffset||0)-(o.scenes[e].northOffset||0):s,m="same"===l?i.hfov:l,function(){var e=i.hotSpots;if(H=!1,delete i.hotSpots,e)for(var t=0;t<e.length;t++){var a=e[t].div;if(a){for(;a.parentNode&&a.parentNode!=Y;)a=a.parentNode;Y.removeChild(a)}delete e[t].div}}(),Oe(e),I.yaw=I.pitch=I.hfov=0,Ue(),d!==a&&(i.pitch=d),f!==a&&(i.yaw=f),m!==a&&(i.hfov=m),Ke("scenechange",e),We()}function qe(){e.removeEventListener("deviceorientation",Ae),$.orientation.classList.remove("pnlm-orientation-button-active"),A=!1}function Ve(){J&&("undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(A=1,e.addEventListener("deviceorientation",Ae),$.orientation.classList.add("pnlm-orientation-button-active"))})):(A=1,e.addEventListener("deviceorientation",Ae),$.orientation.classList.add("pnlm-orientation-button-active")))}function Ze(e){return o.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function je(e,t){try{var a=decodeURIComponent((n=e,n.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})))).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return"about:blank"}var n;return 0===a.indexOf("javascript:")||0===a.indexOf("vbscript:")?(console.log("Script URL removed."),"about:blank"):t&&0===a.indexOf("data:")?(console.log("Data URI removed from link."),"about:blank"):e}function Ke(e){if(e in D)for(var t=D[e].length;t>0;t--)D[e][D[e].length-t].apply(null,[].slice.call(arguments,1))}Ie.prototype.multiply=function(e){return new Ie(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},Ie.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Boolean(h)},this.getPitch=function(){return i.pitch},this.setPitch=function(e,t,n,o){return w=Date.now(),Math.abs(e-i.pitch)<=k?("function"==typeof n&&n(o),this):((t=t==a?1e3:Number(t))?(N.pitch={startTime:Date.now(),startPosition:i.pitch,endPosition:e,duration:t},"function"==typeof n&&setTimeout((function(){n(o)}),t)):i.pitch=e,_e(),this)},this.getPitchBounds=function(){return[i.minPitch,i.maxPitch]},this.setPitchBounds=function(e){return i.minPitch=Math.max(-90,Math.min(e[0],90)),i.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return(i.yaw+540)%360-180},this.setYaw=function(e,t,n,o){return w=Date.now(),Math.abs(e-i.yaw)<=k?("function"==typeof n&&n(o),this):(e=(e+180)%360-180,(t=t==a?1e3:Number(t))?(i.yaw-e>180?e+=360:e-i.yaw>180&&(e-=360),N.yaw={startTime:Date.now(),startPosition:i.yaw,endPosition:e,duration:t},"function"==typeof n&&setTimeout((function(){n(o)}),t)):i.yaw=e,_e(),this)},this.getYawBounds=function(){return[i.minYaw,i.maxYaw]},this.setYawBounds=function(e){return i.minYaw=Math.max(-360,Math.min(e[0],360)),i.maxYaw=Math.max(-360,Math.min(e[1],360)),this},this.getHfov=function(){return i.hfov},this.setHfov=function(e,t,n,o){return w=Date.now(),Math.abs(e-i.hfov)<=k?("function"==typeof n&&n(o),this):((t=t==a?1e3:Number(t))?(N.hfov={startTime:Date.now(),startPosition:i.hfov,endPosition:ze(e),duration:t},"function"==typeof n&&setTimeout((function(){n(o)}),t)):Ge(e),_e(),this)},this.getHfovBounds=function(){return[i.minHfov,i.maxHfov]},this.setHfovBounds=function(e){return i.minHfov=Math.max(0,e[0]),i.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,n,o,r,s){return o=o==a?1e3:Number(o),e!==a&&Math.abs(e-i.pitch)>k&&(this.setPitch(e,o,r,s),r=a),t!==a&&Math.abs(t-i.yaw)>k&&(this.setYaw(t,o,r,s),r=a),n!==a&&Math.abs(n-i.hfov)>k&&(this.setHfov(n,o,r,s),r=a),"function"==typeof r&&r(s),this},this.getNorthOffset=function(){return i.northOffset},this.setNorthOffset=function(e){return i.northOffset=Math.min(360,Math.max(0,e)),_e(),this},this.getHorizonRoll=function(){return i.horizonRoll},this.setHorizonRoll=function(e){return i.horizonRoll=Math.min(90,Math.max(-90,e)),r.setPose(i.horizonPitch*Math.PI/180,i.horizonRoll*Math.PI/180),_e(),this},this.getHorizonPitch=function(){return i.horizonPitch},this.setHorizonPitch=function(e){return i.horizonPitch=Math.min(90,Math.max(-90,e)),r.setPose(i.horizonPitch*Math.PI/180,i.horizonRoll*Math.PI/180),_e(),this},this.startAutoRotate=function(e,t,n,o){return e=e||F||1,t=t===a?m:t,n=n===a?f:n,i.autoRotate=e,o!==a&&(i.autoRotateInactivityDelay=o),v.lookAt(t,a,n,3e3),_e(),this},this.stopAutoRotate=function(){return F=i.autoRotate?i.autoRotate:F,i.autoRotate=!1,i.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){Ye(),I={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return r},this.setUpdate=function(e){return(O=!0===e)&&(U=!1,r===a?ae():_e()),this},this.updateOnce=function(){return O=U=!0,r===a?ae():_e(),this},this.mouseEventToCoords=function(e){return he(e)},this.loadScene=function(e,t,a,n){return!1!==h&&Xe(e,t,a,n),this},this.getScene=function(){return i.scene},this.addScene=function(e,t){return o.scenes[e]=t,this},this.removeScene=function(e){return!(i.scene==e||!o.scenes.hasOwnProperty(e)||(delete o.scenes[e],0))},this.toggleFullscreen=function(){return ke(),this},this.getConfig=function(){return i},this.getContainer=function(){return n},this.addHotSpot=function(e,t){if(t===a&&i.scene===a)i.hotSpots.push(e);else{var n=t!==a?t:i.scene;if(!o.scenes.hasOwnProperty(n))throw"Invalid scene ID!";o.scenes[n].hasOwnProperty("hotSpots")||(o.scenes[n].hotSpots=[],n==i.scene&&(i.hotSpots=o.scenes[n].hotSpots)),o.scenes[n].hotSpots.push(e)}return t!==a&&i.scene!=t||(Fe(e),h&&De(e)),this},this.removeHotSpot=function(e,t){if(t===a||i.scene==t){if(!i.hotSpots)return!1;for(var n=0;n<i.hotSpots.length;n++)if(i.hotSpots[n].hasOwnProperty("id")&&i.hotSpots[n].id==e){for(var r=i.hotSpots[n].div;r.parentNode!=Y;)r=r.parentNode;return Y.removeChild(r),delete i.hotSpots[n].div,i.hotSpots.splice(n,1),!0}}else{if(!o.scenes.hasOwnProperty(t))return!1;if(!o.scenes[t].hasOwnProperty("hotSpots"))return!1;for(var s=0;s<o.scenes[t].hotSpots.length;s++)if(o.scenes[t].hotSpots[s].hasOwnProperty("id")&&o.scenes[t].hotSpots[s].id==e)return o.scenes[t].hotSpots.splice(s,1),!0}},this.resize=function(){r&&Te()},this.isOrientationSupported=function(){return J||!1},this.stopOrientation=function(){qe()},this.startOrientation=function(){Ve()},this.isOrientationActive=function(){return Boolean(A)},this.on=function(e,t){return D[e]=D[e]||[],D[e].push(t),this},this.off=function(e,t){if(!e)return D={},this;if(t){var a=D[e].indexOf(t);a>=0&&D[e].splice(a,1),0==D[e].length&&delete D[e]}else delete D[e];return this},this.destroy=function(){if(z=!0,clearTimeout(d),g&&g.abort(),Array.isArray(c))for(var a=0;a<6;a++)c[a].src="";r&&r.destroy(),L&&(t.removeEventListener("mousemove",ce,!1),t.removeEventListener("mouseup",ue,!1),n.removeEventListener("mozfullscreenchange",He,!1),n.removeEventListener("webkitfullscreenchange",He,!1),n.removeEventListener("msfullscreenchange",He,!1),n.removeEventListener("fullscreenchange",He,!1),p?p.disconnect():(e.removeEventListener("resize",Te,!1),e.removeEventListener("orientationchange",Te,!1)),n.removeEventListener("keydown",be,!1),n.removeEventListener("keyup",Me,!1),n.removeEventListener("blur",Ee,!1),t.removeEventListener("mouseleave",ue,!1)),n.innerHTML="",n.classList.remove("pnlm-container")}}return{viewer:function(e,t){return new n(e,t)}}}(window,document),window.libpannellum=function(e,t,a){function n(n,c){var u,d,f,m,p,g,v,y,w,x,b,E,M,P,R,T,_,L,I;n&&((u=t.createElement("canvas")).style.width=u.style.height="100%",n.appendChild(u));var C=["f","b","u","d","l","r"],A=["f","r","b","l","u","d"];function S(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function F(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function N(e,t,a,n,o,i,r){this.vertices=e,this.side=t,this.level=a,this.x=n,this.y=o;var s="object"==typeof i?i.tileKey:i;s=s.replace("%s",t).replace("%l0",a-1).replace("%l",a).replace("%x",n).replace("%y",o),this.path="object"==typeof i?i[s]:s,this.parentPath=r}function D(e,t,n,o,i,r){if(!(M.missingTileList!==a&&M.missingTileList.indexOf([n.side,n.level,n.x,n.y].toString())>=0)&&function(e,t){var a=j(e,t.slice(0,3)),n=j(e,t.slice(3,6)),o=j(e,t.slice(6,9)),i=j(e,t.slice(9,12)),r=a[0]+n[0]+o[0]+i[0];if(-4==r||4==r)return!1;var s=a[1]+n[1]+o[1]+i[1];return-4!=s&&4!=s&&a[2]+n[2]+o[2]+i[2]!=4}(e,n.vertices)){for(var s=[],l=[],h=2,c=[],u=0,m=0;m<4;m++){var p=Z(t,n.vertices.slice(3*m,3*(m+1)));s.push(p[0]*p[3]),l.push(p[1]*p[3]);var g=p[2]*p[3];h=Math.min(h,g),c.push(Math.abs(s[m])<=1&&Math.abs(l[m])<=1&&g>0),u+=c[m]}var v=M.cubeResolution*Math.pow(2,n.level-M.maxLevel),y=Math.ceil(v*M.invTileResolution)-1,w=v%M.tileResolution*2,x=2*v%M.tileResolution;if(0===x&&(x=M.tileResolution),0===w&&(w=2*M.tileResolution),n.level>1&&h>0&&u>0){var b=0;for(m=0;m<4;m++){var E=(m+1)%4;if(c[m]||c[E]){var P=(s[E]-s[m])*f.drawingBufferWidth/2,R=(l[E]-l[m])*f.drawingBufferHeight/2;x<M.tileResolution&&(n.x==y?P*=M.tileResolution/x:n.y==y&&(R*=M.tileResolution/x)),w<=M.tileResolution&&(n.x==y&&(P*=2),n.y==y&&(R*=2)),b=Math.max(b,Math.sqrt(P*P+R*R))}}if(b<=M.tileResolution/2)return}var T=n.vertices,_=T[0]+T[3]+T[6]+T[9],L=T[1]+T[4]+T[7]+T[10],I=T[2]+T[5]+T[8]+T[11],C=Math.sqrt(_*_+L*L+I*I),A=Math.asin(I/C),S=Math.atan2(L,_)-i;S+=S>Math.PI?-2*Math.PI:S<-Math.PI?2*Math.PI:0,S=Math.abs(S),n.diff=Math.acos(Math.sin(o)*Math.sin(A)+Math.cos(o)*Math.cos(A)*Math.cos(S));for(var F=!1,B=0;B<d.nodeCache.length;B++)if(d.nodeCache[B].path==n.path){F=!0,d.nodeCache[B].timestamp=d.nodeCacheTimestamp++,d.nodeCache[B].diff=n.diff,d.currentNodes.push(d.nodeCache[B]);break}if(F||(n.timestamp=d.nodeCacheTimestamp++,d.currentNodes.push(n),d.nodeCache.push(n)),n.level<M.maxLevel){var O=.5;n.x!=y&&n.y!=y||(O=1-M.tileResolution/(M.tileResolution+x));var U,k=[],H=O,z=O,G=O,Y=m=1-O,W=m,X=m;for(x<M.tileResolution&&(n.x==y&&n.y!=y?(z=.5,W=.5,"d"!=n.side&&"u"!=n.side||(G=.5,X=.5)):n.x!=y&&n.y==y&&(H=.5,Y=.5,"l"!=n.side&&"r"!=n.side||(G=.5,X=.5))),w<=M.tileResolution?(n.x==y&&(H=0,Y=1,"l"!=n.side&&"r"!=n.side||(G=0,X=1),n.numChildren=2),n.y==y&&(z=0,W=1,"d"!=n.side&&"u"!=n.side||(G=0,X=1),n.numChildren=2),n.x==y&&n.y==y&&(n.numChildren=1)):n.numChildren=4,U=new N(new Float32Array([T[0],T[1],T[2],T[0]*H+T[3]*Y,T[1]*O+T[4]*m,T[2]*G+T[5]*X,T[0]*H+T[6]*Y,T[1]*z+T[7]*W,T[2]*G+T[8]*X,T[0]*O+T[9]*m,T[1]*z+T[10]*W,T[2]*G+T[11]*X]),n.side,n.level+1,2*n.x,2*n.y,M.fullpath,n.path),k.push(U),n.x==y&&w<=M.tileResolution||(U=new N(new Float32Array([T[0]*H+T[3]*Y,T[1]*O+T[4]*m,T[2]*G+T[5]*X,T[3],T[4],T[5],T[3]*O+T[6]*m,T[4]*z+T[7]*W,T[5]*G+T[8]*X,T[0]*H+T[6]*Y,T[1]*z+T[7]*W,T[2]*G+T[8]*X]),n.side,n.level+1,2*n.x+1,2*n.y,M.fullpath,n.path),k.push(U)),n.x==y&&w<=M.tileResolution||n.y==y&&w<=M.tileResolution||(U=new N(new Float32Array([T[0]*H+T[6]*Y,T[1]*z+T[7]*W,T[2]*G+T[8]*X,T[3]*O+T[6]*m,T[4]*z+T[7]*W,T[5]*G+T[8]*X,T[6],T[7],T[8],T[9]*H+T[6]*Y,T[10]*O+T[7]*m,T[11]*G+T[8]*X]),n.side,n.level+1,2*n.x+1,2*n.y+1,M.fullpath,n.path),k.push(U)),n.y==y&&w<=M.tileResolution||(U=new N(new Float32Array([T[0]*O+T[9]*m,T[1]*z+T[10]*W,T[2]*G+T[11]*X,T[0]*H+T[6]*Y,T[1]*z+T[7]*W,T[2]*G+T[8]*X,T[9]*H+T[6]*Y,T[10]*O+T[7]*m,T[11]*G+T[8]*X,T[9],T[10],T[11]]),n.side,n.level+1,2*n.x,2*n.y+1,M.fullpath,n.path),k.push(U)),E=0;E<k.length;E++)D(e,t,k[E],o,i,r)}else n.numChildren=0}}function B(){return new Float32Array([-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1])}function O(e,t,a){var n=Math.sin(t),o=Math.cos(t);return"x"==a?new Float32Array([e[0],o*e[1]+n*e[2],o*e[2]-n*e[1],e[3],o*e[4]+n*e[5],o*e[5]-n*e[4],e[6],o*e[7]+n*e[8],o*e[8]-n*e[7]]):"y"==a?new Float32Array([o*e[0]-n*e[2],e[1],o*e[2]+n*e[0],o*e[3]-n*e[5],e[4],o*e[5]+n*e[3],o*e[6]-n*e[8],e[7],o*e[8]+n*e[6]]):"z"==a?new Float32Array([o*e[0]+n*e[1],o*e[1]-n*e[0],e[2],o*e[3]+n*e[4],o*e[4]-n*e[3],e[5],o*e[6]+n*e[7],o*e[7]-n*e[6],e[8]]):void 0}function U(e){return new Float32Array([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]])}function k(e,t,a,n){var o=2*Math.atan(Math.tan(e/2)*f.drawingBufferHeight/f.drawingBufferWidth),i=1/Math.tan(o/2);return new Float32Array([i/t,0,0,0,0,i,0,0,0,0,(n+a)/(a-n),2*n*a/(a-n),0,0,-1,0])}function H(e,t){f.bindTexture(f.TEXTURE_2D,t),f.texImage2D(f.TEXTURE_2D,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.bindTexture(f.TEXTURE_2D,null)}c&&(f=c),this.init=function(e,c,C,S,F,N,D){if(c===a&&(c="equirectangular"),"equirectangular"!=c&&"cubemap"!=c&&"multires"!=c)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(P=c,M=e,I=D||{},d){if(m&&(f.detachShader(d,m),f.deleteShader(m)),p&&(f.detachShader(d,p),f.deleteShader(p)),f.bindBuffer(f.ARRAY_BUFFER,null),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,null),d.texture&&f.deleteTexture(d.texture),d.nodeCache)for(var O=0;O<d.nodeCache.length;O++)f.deleteTexture(d.nodeCache[O].texture);if(d.textureLoads)for(G=[];d.textureLoads.length>0;)d.textureLoads.shift()(!1);f.deleteProgram(d),d=a}var U;g&&(v&&(f.detachShader(g,v),f.deleteShader(v)),y&&(f.detachShader(g,y),f.deleteShader(y)),f.deleteProgram(g),g=a),E=a;var k,H=!1;if("cubemap"==P)for(U=0;U<6;U++)M[U].width>0?(k===a&&(k=M[U].width),k!=M[U].width&&console.log("Cube faces have inconsistent widths: "+k+" vs. "+M[U].width)):H=!0;function z(e){if(H){var t=e*e*4,a=new Uint8ClampedArray(t),n=D.backgroundColor?D.backgroundColor:[0,0,0];n[0]*=255,n[1]*=255,n[2]*=255;for(var o=0;o<t;o++)a[o++]=n[0],a[o++]=n[1],a[o++]=n[2];var i=new ImageData(a,e,e);for(U=0;U<6;U++)0==M[U].width&&(M[U]=i)}}if("cubemap"==P&&k&k-1&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(f||(f=u.getContext("experimental-webgl",{alpha:!1,depth:!1})),f&&1286==f.getError()&&K()),f||!("multires"==P&&M.hasOwnProperty("fallbackPath")||"cubemap"==P)||!("WebkitAppearance"in t.documentElement.style)&&!navigator.userAgent.match(/Trident.*rv[ :]*11\./)&&-1===navigator.appVersion.indexOf("MSIE 10")){if(!f)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};"cubemap"==P&&z(k),M.basePath?M.fullpath=M.basePath+M.path:M.fullpath=M.path,M.invTileResolution=1/M.tileResolution;var Y=B();for(b=[],U=0;U<6;U++)b[U]=Y.slice(12*U,12*U+12),Y=B();var W=0;if("equirectangular"==P){if(W=f.getParameter(f.MAX_TEXTURE_SIZE),Math.max(M.width/2,M.height)>W)throw console.log("Error: The image is too big; it's "+M.width+"px wide, but this device's maximum supported size is "+2*W+"px."),{type:"webgl size error",width:M.width,maxWidth:2*W}}else if("cubemap"==P&&k>f.getParameter(f.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+k+"px wide, but this device's maximum supported size is "+W+"px."),{type:"webgl size error",width:k,maxWidth:W};if(D!==a){var X=isNaN(D.horizonPitch)?0:Number(D.horizonPitch),q=isNaN(D.horizonRoll)?0:Number(D.horizonRoll);0==X&&0==q||(E=[X,q])}var V=f.TEXTURE_2D;if(f.viewport(0,0,f.drawingBufferWidth,f.drawingBufferHeight),f.getShaderPrecisionFormat){var Z=f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT);Z&&Z.precision<1&&(r=r.replace("highp","mediump"))}m=f.createShader(f.VERTEX_SHADER);var j=o;"multires"==P&&(j=i),f.shaderSource(m,j),f.compileShader(m),p=f.createShader(f.FRAGMENT_SHADER);var $=l;if("cubemap"==P?(V=f.TEXTURE_CUBE_MAP,$=s):"multires"==P&&($=h),f.shaderSource(p,$),f.compileShader(p),d=f.createProgram(),f.attachShader(d,m),f.attachShader(d,p),f.linkProgram(d),f.getShaderParameter(m,f.COMPILE_STATUS)||console.log(f.getShaderInfoLog(m)),f.getShaderParameter(p,f.COMPILE_STATUS)||console.log(f.getShaderInfoLog(p)),f.getProgramParameter(d,f.LINK_STATUS)||console.log(f.getProgramInfoLog(d)),f.useProgram(d),d.drawInProgress=!1,null!==D.backgroundColor){var ie=D.backgroundColor?D.backgroundColor:[0,0,0];f.clearColor(ie[0],ie[1],ie[2],1),f.clear(f.COLOR_BUFFER_BIT)}if(d.texCoordLocation=f.getAttribLocation(d,"a_texCoord"),f.enableVertexAttribArray(d.texCoordLocation),"multires"!=P){if(R||(R=f.createBuffer()),f.bindBuffer(f.ARRAY_BUFFER,R),f.bufferData(f.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),f.STATIC_DRAW),f.vertexAttribPointer(d.texCoordLocation,2,f.FLOAT,!1,0,0),d.aspectRatio=f.getUniformLocation(d,"u_aspectRatio"),f.uniform1f(d.aspectRatio,f.drawingBufferWidth/f.drawingBufferHeight),d.psi=f.getUniformLocation(d,"u_psi"),d.theta=f.getUniformLocation(d,"u_theta"),d.f=f.getUniformLocation(d,"u_f"),d.h=f.getUniformLocation(d,"u_h"),d.v=f.getUniformLocation(d,"u_v"),d.vo=f.getUniformLocation(d,"u_vo"),d.rot=f.getUniformLocation(d,"u_rot"),f.uniform1f(d.h,C/(2*Math.PI)),f.uniform1f(d.v,S/Math.PI),f.uniform1f(d.vo,F/Math.PI*2),"equirectangular"==P&&(d.backgroundColor=f.getUniformLocation(d,"u_backgroundColor"),f.uniform4fv(d.backgroundColor,ie.concat([1]))),d.texture=f.createTexture(),f.bindTexture(V,d.texture),"cubemap"==P)f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,M[1]),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_X,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,M[3]),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_Y,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,M[4]),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,M[5]),f.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_Z,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,M[0]),f.texImage2D(f.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,M[2]);else if(M.width<=W)f.uniform1i(f.getUniformLocation(d,"u_splitImage"),0),f.texImage2D(V,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,M);else{f.uniform1i(f.getUniformLocation(d,"u_splitImage"),1);var re=t.createElement("canvas");re.width=M.width/2,re.height=M.height;var se=re.getContext("2d");se.drawImage(M,0,0);var le=se.getImageData(0,0,M.width/2,M.height);f.texImage2D(V,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,le),d.texture2=f.createTexture(),f.activeTexture(f.TEXTURE1),f.bindTexture(V,d.texture2),f.uniform1i(f.getUniformLocation(d,"u_image1"),1),se.drawImage(M,-M.width/2,0),le=se.getImageData(0,0,M.width/2,M.height),f.texImage2D(V,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,le),f.texParameteri(V,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(V,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(V,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(V,f.TEXTURE_MAG_FILTER,f.LINEAR),f.activeTexture(f.TEXTURE0)}"cubemap"!=P&&M.width&&M.width<=W&&C==2*Math.PI&&!(M.width&M.width-1)?f.texParameteri(V,f.TEXTURE_WRAP_S,f.REPEAT):f.texParameteri(V,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(V,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(V,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(V,f.TEXTURE_MAG_FILTER,f.LINEAR)}else{if(d.vertPosLocation=f.getAttribLocation(d,"a_vertCoord"),f.enableVertexAttribArray(d.vertPosLocation),T||(T=f.createBuffer()),_||(_=f.createBuffer()),L||(L=f.createBuffer()),f.bindBuffer(f.ARRAY_BUFFER,_),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),f.STATIC_DRAW),f.vertexAttribPointer(d.texCoordLocation,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,L),f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),f.STATIC_DRAW),f.bindBuffer(f.ARRAY_BUFFER,T),f.vertexAttribPointer(d.vertPosLocation,3,f.FLOAT,!1,0,0),d.perspUniform=f.getUniformLocation(d,"u_perspMatrix"),d.cubeUniform=f.getUniformLocation(d,"u_cubeMatrix"),d.currentNodes=[],d.nodeCache=[],d.nodeCacheTimestamp=0,d.textureLoads=[],M.shtHash||M.equirectangularThumbnail){var he,ce,ue;v=f.createShader(f.VERTEX_SHADER),f.shaderSource(v,o),f.compileShader(v),y=f.createShader(f.FRAGMENT_SHADER),f.shaderSource(y,l),f.compileShader(y),g=f.createProgram(),f.attachShader(g,v),f.attachShader(g,y),f.linkProgram(g),f.getShaderParameter(v,f.COMPILE_STATUS)||console.log(f.getShaderInfoLog(v)),f.getShaderParameter(y,f.COMPILE_STATUS)||console.log(f.getShaderInfoLog(y)),f.getProgramParameter(g,f.LINK_STATUS)||console.log(f.getProgramInfoLog(g)),f.useProgram(g),g.texCoordLocation=f.getAttribLocation(g,"a_texCoord"),f.enableVertexAttribArray(g.texCoordLocation),R||(R=f.createBuffer()),f.bindBuffer(f.ARRAY_BUFFER,R),f.bufferData(f.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),f.STATIC_DRAW),f.vertexAttribPointer(g.texCoordLocation,2,f.FLOAT,!1,0,0),g.aspectRatio=f.getUniformLocation(g,"u_aspectRatio"),f.uniform1f(g.aspectRatio,f.drawingBufferWidth/f.drawingBufferHeight),g.psi=f.getUniformLocation(g,"u_psi"),g.theta=f.getUniformLocation(g,"u_theta"),g.f=f.getUniformLocation(g,"u_f"),g.h=f.getUniformLocation(g,"u_h"),g.v=f.getUniformLocation(g,"u_v"),g.vo=f.getUniformLocation(g,"u_vo"),g.rot=f.getUniformLocation(g,"u_rot"),f.uniform1f(g.h,1),g.texture=f.createTexture(),f.bindTexture(V,g.texture);var de=function(){f.useProgram(g),f.uniform1i(f.getUniformLocation(g,"u_splitImage"),0),f.texImage2D(V,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,he),f.texParameteri(V,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(V,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(V,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(V,f.TEXTURE_MAG_FILTER,f.LINEAR),f.uniform1f(g.v,ce),f.uniform1f(g.vo,ue),f.useProgram(d)};if(M.shtHash&&(he=function(e){if(ee.length<1)for(var t=J.length/32,a=0;a<32;a++){ee.push([]);for(var n=0;n<t;n++)ee[a].push(te(ne(J[a*t+n],1),41)*Q)}ne(e[0],1)[0];var o=255*(te(ne(e[1],1),41)+1)/2,i=ne(e.slice(2),2),r=[],s=[],l=[];for(a=0;a<i.length;a++){var h=ae(i[a],o);r.push(h[0]),s.push(h[1]),l.push(h[2])}var c=.03125*Math.PI,u=[];for(a=31;a>=0;a--)for(n=0;n<64;n++)u.push(oe(r,ee[a],(n+.5)*c)),u.push(oe(s,ee[a],(n+.5)*c)),u.push(oe(l,ee[a],(n+.5)*c)),u.push(255);return new ImageData(new Uint8ClampedArray(u),64,32)}(M.shtHash),ce=(2+1/31)/2,ue=1-(2+1/31)/2,de()),M.equirectangularThumbnail)if("string"==typeof M.equirectangularThumbnail){if("data:"!=M.equirectangularThumbnail.slice(0,5))throw console.log("Error: thumbnail string is not a data URI!"),{type:"config error"};(he=new Image).onload=function(){ce=1,ue=0,de()},he.src=M.equirectangularThumbnail}else he=M.equirectangularThumbnail,ce=1,ue=0,de();f.bindBuffer(f.ARRAY_BUFFER,T),f.vertexAttribPointer(d.vertPosLocation,3,f.FLOAT,!1,0,0),f.useProgram(d)}if(M.missingTiles){var fe=[],me=M.missingTiles.split("!"),pe=-1;for(O=1;O<me.length;O++)for(var ge=me[O].at(0),ve=me[O].indexOf(">")<0?[ge,me[O].slice(1)]:me[O].split(">"),ye=1;ye<ve.length;ye++){me[O].indexOf(">")>=0&&(pe=ne(ve[ye].at(0),1)[0]);for(var we=Math.ceil(M.cubeResolution/Math.pow(2,M.maxLevel-pe)/M.tileResolution)-1,xe=Math.ceil(Math.log(we+1)/Math.log(83)),be=ve[ye].slice(1).length>0?ne(ve[ye].slice(1),xe):[0,0],Ee=0;Ee<be.length/2;Ee++)fe.push([ge,pe,be[2*Ee],be[2*Ee+1]].toString())}M.missingTileList=fe}}var Me=f.getError();if(0!==Me)throw console.log("Error: Something went wrong with WebGL!",Me),{type:"webgl error"};N()}else{var Pe;x&&n.removeChild(x),(x=t.createElement("div")).className="pnlm-world",Pe=M.basePath?M.basePath+M.fallbackPath:M.fallbackPath;var Re=0,Te=function(){var e=t.createElement("canvas");e.className="pnlm-face pnlm-"+A[this.side]+"face",x.appendChild(e);var a=e.getContext("2d");e.style.width=this.width+4+"px",e.style.height=this.height+4+"px",e.width=this.width+4,e.height=this.height+4,a.drawImage(this,2,2);var n,o,i=a.getImageData(0,0,e.width,e.height),r=i.data;for(n=2;n<e.width-2;n++)for(o=0;o<4;o++)r[4*(n+e.width)+o]=r[4*(n+2*e.width)+o],r[4*(n+e.width*(e.height-2))+o]=r[4*(n+e.width*(e.height-3))+o];for(n=2;n<e.height-2;n++)for(o=0;o<4;o++)r[4*(n*e.width+1)+o]=r[4*(n*e.width+2)+o],r[4*((n+1)*e.width-2)+o]=r[4*((n+1)*e.width-3)+o];for(o=0;o<4;o++)r[4*(e.width+1)+o]=r[4*(2*e.width+2)+o],r[4*(2*e.width-2)+o]=r[4*(3*e.width-3)+o],r[4*(e.width*(e.height-2)+1)+o]=r[4*(e.width*(e.height-3)+2)+o],r[4*(e.width*(e.height-1)-2)+o]=r[4*(e.width*(e.height-2)-3)+o];for(n=1;n<e.width-1;n++)for(o=0;o<4;o++)r[4*n+o]=r[4*(n+e.width)+o],r[4*(n+e.width*(e.height-1))+o]=r[4*(n+e.width*(e.height-2))+o];for(n=1;n<e.height-1;n++)for(o=0;o<4;o++)r[n*e.width*4+o]=r[4*(n*e.width+1)+o],r[4*((n+1)*e.width-1)+o]=r[4*((n+1)*e.width-2)+o];for(o=0;o<4;o++)r[o]=r[4*(e.width+1)+o],r[4*(e.width-1)+o]=r[4*(2*e.width-2)+o],r[e.width*(e.height-1)*4+o]=r[4*(e.width*(e.height-2)+1)+o],r[4*(e.width*e.height-1)+o]=r[4*(e.width*(e.height-1)-2)+o];a.putImageData(i,0,0),_e.call(this)},_e=function(){this.width>0?(w===a&&(w=this.width),w!=this.width&&console.log("Fallback faces have inconsistent widths: "+w+" vs. "+this.width)):H=!0,6==++Re&&(w=this.width,n.appendChild(x),N())};for(H=!1,U=0;U<6;U++){var Le=new Image;Le.crossOrigin=I.crossOrigin?I.crossOrigin:"anonymous",Le.side=U,Le.onload=Te,Le.onerror=_e,Le.src="multires"==P?Pe.replace("%s",A[U])+(M.extension?"."+M.extension:""):M[U].src}z(w)}},this.destroy=function(){if(n!==a&&(u!==a&&n.contains(u)&&n.removeChild(u),x!==a&&n.contains(x)&&n.removeChild(x)),f){var e=f.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var t=e.devicePixelRatio||1;u.width=u.clientWidth*t,u.height=u.clientHeight*t,f&&(1286==f.getError()&&K(),f.viewport(0,0,f.drawingBufferWidth,f.drawingBufferHeight),"multires"!=P?f.uniform1f(d.aspectRatio,u.clientWidth/u.clientHeight):M.shtHash&&(f.useProgram(g),f.uniform1f(g.aspectRatio,u.clientWidth/u.clientHeight),f.useProgram(d)))},u&&this.resize(),this.setPose=function(e,t){e=isNaN(e)?0:Number(e),t=isNaN(t)?0:Number(t),E=0==e&&0==t?a:[e,t]},this.render=function(t,n,o,i){var r,s,l=0;if(i===a&&(i={}),i.roll&&(l=i.roll),i.dynamic)var h=i.dynamic;if(E!==a){var c=E[0],m=E[1],p=t,v=n,y=Math.cos(m)*Math.sin(t)*Math.sin(c)+Math.cos(t)*(Math.cos(c)*Math.cos(n)+Math.sin(m)*Math.sin(c)*Math.sin(n)),I=-Math.sin(t)*Math.sin(m)+Math.cos(t)*Math.cos(m)*Math.sin(n),A=Math.cos(m)*Math.cos(c)*Math.sin(t)+Math.cos(t)*(-Math.cos(n)*Math.sin(c)+Math.cos(c)*Math.sin(m)*Math.sin(n));t=Math.asin(Math.max(Math.min(A,1),-1)),n=Math.atan2(I,y);var B=[Math.cos(p)*(Math.sin(m)*Math.sin(c)*Math.cos(v)-Math.cos(c)*Math.sin(v)),Math.cos(p)*Math.cos(m)*Math.cos(v),Math.cos(p)*(Math.cos(c)*Math.sin(m)*Math.cos(v)+Math.sin(v)*Math.sin(c))],H=[-Math.cos(t)*Math.sin(n),Math.cos(t)*Math.cos(n)],Y=Math.acos(Math.max(Math.min((B[0]*H[0]+B[1]*H[1])/(Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2])*Math.sqrt(H[0]*H[0]+H[1]*H[1])),1),-1));B[2]<0&&(Y=2*Math.PI-Y),l+=Y}if(i.hook&&i.hook({gl:f,program:d,previewProgram:g,imageType:P,texCoordBuffer:R,cubeVertBuf:T,cubeVertTexCoordBuf:_,cubeVertIndBuf:L}),f||"multires"!=P&&"cubemap"!=P){if("multires"!=P){var W=2*Math.atan(Math.tan(.5*o)/(f.drawingBufferWidth/f.drawingBufferHeight));r=1/Math.tan(.5*W),f.uniform1f(d.psi,n),f.uniform1f(d.theta,t),f.uniform1f(d.rot,l),f.uniform1f(d.f,r),!0===h&&"equirectangular"==P&&(f.bindTexture(f.TEXTURE_2D,d.texture),f.texImage2D(f.TEXTURE_2D,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,M)),f.drawArrays(f.TRIANGLES,0,6)}else{var X=void 0!==M.shtHash||void 0!==M.equirectangularThumbnail,q=X;if(X&&d.currentNodes.length>=6){q=!1;for(var Z=0;Z<6;Z++)if(!d.currentNodes[Z].textureLoaded){q=!0;break}}q&&(f.useProgram(g),f.bindBuffer(f.ARRAY_BUFFER,R),f.vertexAttribPointer(g.texCoordLocation,2,f.FLOAT,!1,0,0),f.bindTexture(f.TEXTURE_2D,g.texture),W=2*Math.atan(Math.tan(.5*o)/(f.drawingBufferWidth/f.drawingBufferHeight)),r=1/Math.tan(.5*W),f.uniform1f(g.psi,n),f.uniform1f(g.theta,t),f.uniform1f(g.rot,l),f.uniform1f(g.f,r),f.drawArrays(f.TRIANGLES,0,6),f.bindBuffer(f.ARRAY_BUFFER,T),f.vertexAttribPointer(d.vertPosLocation,3,f.FLOAT,!1,0,0),f.useProgram(d));var j=k(o,f.drawingBufferWidth/f.drawingBufferHeight,.1,100),K=k(o,f.drawingBufferWidth/f.drawingBufferHeight,-100,100),$=new Float32Array([1,0,0,0,1,0,0,0,1]);$=O($,-l,"z"),$=O($,-t,"x"),$=O($,n,"y"),ne=$,$=new Float32Array([ne[0],ne[1],ne[2],0,ne[3],ne[4],ne[5],0,ne[6],ne[7],ne[8],0,0,0,0,1]),f.uniformMatrix4fv(d.perspUniform,!1,U(j)),f.uniformMatrix4fv(d.cubeUniform,!1,U($));var J=V(j,$),Q=V(K,$);if(d.nodeCache.sort(S),d.nodeCache.length>200&&d.nodeCache.length>d.currentNodes.length+50)for(var ee=d.nodeCache.splice(200,d.nodeCache.length-200),te=0;te<ee.length;te++)f.deleteTexture(ee[te].texture);for(d.currentNodes=[],s=0;s<6;s++)D(J,Q,new N(b[s],C[s],1,0,0,M.fullpath,null),t,n,o);for(d.currentNodes.sort(F),Z=G.length-1;Z>=0;Z--)-1===d.currentNodes.indexOf(G[Z].node)&&(G[Z].node.textureLoad=!1,G.splice(Z,1));if(0===G.length)for(Z=0;Z<d.currentNodes.length;Z++){var ae=d.currentNodes[Z];if(!ae.texture&&!ae.textureLoad){ae.textureLoad=!0,setTimeout(z,0,ae);break}}d.textureLoads.length>0&&d.textureLoads.shift()(!0),function(e){if(!d.drawInProgress){d.drawInProgress=!0,e&&f.clear(f.COLOR_BUFFER_BIT);for(var t={},n=0;n<d.currentNodes.length;n++)t[d.currentNodes[n].parentPath]===a&&(t[d.currentNodes[n].parentPath]=0),t[d.currentNodes[n].parentPath]+=d.currentNodes[n].textureLoaded>1;for(n=0;n<d.currentNodes.length;n++)d.currentNodes[n].textureLoaded>1&&t[d.currentNodes[n].path]!=d.currentNodes[n].numChildren&&(f.bufferData(f.ARRAY_BUFFER,d.currentNodes[n].vertices,f.STATIC_DRAW),f.bindTexture(f.TEXTURE_2D,d.currentNodes[n].texture),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0));d.drawInProgress=!1}}(!X)}var ne;if(i.returnImage!==a)return e.createImageBitmap&&"ImageBitmap"==i.returnImage?createImageBitmap(u):0==i.returnImage.toString().indexOf("image/")?u.toDataURL(i.returnImage):u.toDataURL("image/png")}else{var oe={f:"translate3d(-"+(2+(s=w/2))+"px, -"+(s+2)+"px, -"+s+"px)",b:"translate3d("+(s+2)+"px, -"+(s+2)+"px, "+s+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(s+2)+"px, -"+s+"px, "+(s+2)+"px) rotateX(270deg)",d:"translate3d(-"+(s+2)+"px, "+s+"px, -"+(s+2)+"px) rotateX(90deg)",l:"translate3d(-"+s+"px, -"+(s+2)+"px, "+(s+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+s+"px, -"+(s+2)+"px, -"+(s+2)+"px) rotateY(270deg)"},ie=(r=1/Math.tan(o/2))*u.clientWidth/2+"px",re="perspective("+ie+") translateZ("+ie+") rotateX("+t+"rad) rotateY("+n+"rad) ",se=Object.keys(oe);for(Z=0;Z<6;Z++){var le=x.querySelector(".pnlm-"+se[Z]+"face");le&&(le.style.webkitTransform=re+oe[se[Z]],le.style.transform=re+oe[se[Z]])}}},this.isLoading=function(){if(f&&"multires"==P)for(var e=0;e<d.currentNodes.length;e++)if(!d.currentNodes[e].textureLoaded)return!0;return!1},this.isBaseLoaded=function(){if(d.currentNodes.length>=6){for(var e=0;e<6;e++)if(!d.currentNodes[e].textureLoaded)return!1;return!0}return!1},this.getCanvas=function(){return u};var z,G=[],Y=function(){var e,t=4,a={};function n(){var n=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=e||"anonymous";var o=function(){d.textureLoads.push((function(e){e&&(n.image.width>0&&n.image.height>0?(H(n.image,n.texture),n.callback(n.texture,!0)):n.callback(n.texture,!1)),function(e){if(G.length){var n=G.shift();e.loadTexture(n.src,n.texture,n.callback)}else a[t++]=e}(n)}))};this.image.addEventListener("load",o),this.image.addEventListener("error",o)}function o(e,t,a,n){this.node=e,this.src=t,this.texture=a,this.callback=n}n.prototype.loadTexture=function(e,t,a){this.texture=t,this.callback=a,this.image.src=e};for(var i=0;i<t;i++)a[i]=new n;return function(n,i,r,s){e=s;var l=f.createTexture();return t?a[--t].loadTexture(i,l,r):G.push(new o(n,i,l,r)),l}}();if(e.Worker&&e.createImageBitmap){function ie(){self.onmessage=function(e){var t=e.data[0],a=e.data[1];fetch(t,{mode:"cors",credentials:"use-credentials"==a?"include":"same-origin"}).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e)})).then((function(e){postMessage([t,!0,e],[e])})).catch((function(){postMessage([t,!1])}))}}var W=new Blob(["("+ie.toString()+")()"],{type:"application/javascript"}),X=new Worker(URL.createObjectURL(W)),q={};X.onmessage=function(e){var t=e.data[0],n=e.data[1],o=e.data[2];d.textureLoads.push((function(e){var i,r=!1;n&&e&&(i=f.createTexture(),H(o,i),r=!0);var s=q[t];delete q[t],s!==a&&(s.texture=i,s.textureLoaded=r?2:1)}))},z=function(t){var a=new URL(t.path+(M.extension?"."+M.extension:""),e.location).href;q[a]=t,X.postMessage([a,I.crossOrigin])}}else z=function(e){Y(e,e.path+(M.extension?"."+M.extension:""),(function(t,a){e.texture=t,e.textureLoaded=a?2:1}),I.crossOrigin)};function V(e,t){return new Float32Array([e[0]*t[0],e[0]*t[1],e[0]*t[2],0,e[5]*t[4],e[5]*t[5],e[5]*t[6],0,e[10]*t[8],e[10]*t[9],e[10]*t[10],e[11],-t[8],-t[9],-t[10],0])}function Z(e,t){return new Float32Array([e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e[11]+e[8]*t[0]+e[9]*t[1]+e[10]*t[2],1/(e[12]*t[0]+e[13]*t[1]+e[14]*t[2])])}function j(e,t){var a=Z(e,t),n=a[0]*a[3],o=a[1]*a[3],i=a[2]*a[3],r=[0,0,0];return n<-1&&(r[0]=-1),n>1&&(r[0]=1),o<-1&&(r[1]=-1),o>1&&(r[1]=1),(i<-1||i>1)&&(r[2]=1),r}function K(){console.log("Reducing canvas size due to error 1286!"),u.width=Math.round(u.width/2),u.height=Math.round(u.height/2)}var $="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",J="Bf[ff4fff|ffff0fffffBo@Ri5xag{Jmdf2+WiefCs@Ll7+Vi]Btag6[NmdgCv=Ho9;Qk;7zWiF_GsahDy:ErE?Mn$5+SkS_AyWiD#-CuJ[Iqp6;Nnx?7*SlE$*BxR@FtPA?Jq+%7:NnF*zAzn?CwIG@Ft-Y9?IrG+vA%w:AzGR?Cx*IF@EuI,nA+$*9%Gu:A#xCR?ByJ-VB-*wA+J**9*ZBv:9%L.QD.*aB.O.v9-MF+$8,O:MG:*OD;a:UB:IO:n9:Q:KJ;#IG=u-KE=Hs:MC?T:IO=wEL?#%FJ@K**FI@Y;HV=pDU?*sCS@S.uCR[m;Hp=VDq?*SCs@s.QCt[r:Iw=OEz?#IF$@#*HF%@u:K$;KI+=uEK-=*sCM:?w:M+:HO.;aCU;:%OCn?:z.Q..Ha;.ODv?-yFG$@,$-V;-Hw=+JH*?*lBP:?%%,n=+J*?%GQ:=#NCt?;y++v=%O:=zGt?:xHI,@-u,*z=zX?:wI+@,tEY??%r-$*;xt@,tP=?$qG%[:xn.#-:u$[%qp];xnN?[*sl.y:-r-?yn$^+sks_=yoi:v=*o?;uk;[zoi,_+skh:s@zl[+pi];tkg][xmhg;o@ti^xkg{$mhf|+oigf;f[ff_fff|ffff~fffff",Q=3.317,ee=[];function te(e,t){return Math.pow((Math.abs(e)-t)/t,2)*(e-t>0?1:-1)}function ae(e,t){var a=Math.floor(e/361),n=Math.floor(e/19)%19,o=e%19;return[te(a,9)*t,te(n,9)*t,te(o,9)*t]}function ne(e,t){for(var a=Math.floor(e.length/t),n=[],o=0;o<a;o++){for(var i=0,r=0;r<t;r++)i=83*i+$.indexOf(e[o*t+r]);n.push(i)}return n}function oe(e,t,a){var n=Math.floor(Math.sqrt(e.length))-1,o=Array(n+1),i=Array(n+1);i[0]=0,o[0]=1,i[1]=Math.sin(a),o[1]=Math.cos(a);for(var r=2;r<=n;r++)i[r]=2*i[r-1]*o[1]-i[r-2],o[r]=2*o[r-1]*o[1]-o[r-2];for(var s=0,l=0,h=1;h<=n+1;h++)l+=h;for(var c=n;c>=0;c--){var u=Math.floor((c+1)*c/2);for(s+=0!=u?e[u]*t[u-1]:e[u],r=1;r<=c;r++)s+=(e[++u]*o[r]+e[u+l-c-1]*i[r])*t[u-1]}return Math.round(s)}}var o=["attribute vec2 a_texCoord;","varying vec2 v_texCoord;","void main() {","gl_Position = vec4(a_texCoord, 0.0, 1.0);","v_texCoord = a_texCoord;","}"].join(""),i=["attribute vec3 a_vertCoord;","attribute vec2 a_texCoord;","uniform mat4 u_cubeMatrix;","uniform mat4 u_perspMatrix;","varying mediump vec2 v_texCoord;","void main(void) {","gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);","v_texCoord = a_texCoord;","}"].join(""),r=["precision highp float;","uniform float u_aspectRatio;","uniform float u_psi;","uniform float u_theta;","uniform float u_f;","uniform float u_h;","uniform float u_v;","uniform float u_vo;","uniform float u_rot;","const float PI = 3.14159265358979323846264;","uniform sampler2D u_image0;","uniform sampler2D u_image1;","uniform bool u_splitImage;","uniform samplerCube u_imageCube;","varying vec2 v_texCoord;","uniform vec4 u_backgroundColor;","void main() {","float x = v_texCoord.x * u_aspectRatio;","float y = v_texCoord.y;","float sinrot = sin(u_rot);","float cosrot = cos(u_rot);","float rot_x = x * cosrot - y * sinrot;","float rot_y = x * sinrot + y * cosrot;","float sintheta = sin(u_theta);","float costheta = cos(u_theta);","float a = u_f * costheta - rot_y * sintheta;","float root = sqrt(rot_x * rot_x + a * a);","float lambda = atan(rot_x / root, a / root) + u_psi;","float phi = atan((rot_y * costheta + u_f * sintheta) / root);"].join("\n"),s=r+["float cosphi = cos(phi);","gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));","}"].join("\n"),l=r+["lambda = mod(lambda + PI, PI * 2.0) - PI;","vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));","if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)","gl_FragColor = u_backgroundColor;","else {","if(u_splitImage) {","if(coord.x < 0.0)","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","else","gl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","} else {","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));","}","}","}"].join("\n"),h=["varying mediump vec2 v_texCoord;","uniform sampler2D u_sampler;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","}"].join("");return{renderer:function(e,t,a){return new n(e,t,a)}}}(window,document)})();